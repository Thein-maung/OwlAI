<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>မြန်မာစာ AI အကူ - DeepSeek Free API</title>
    <style>
        /* ရှိပြီးသား CSS ကုဒ်များ */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Pyidaungsu', 'Myanmar3', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 500px;
            height: 700px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ကျန်ရှိသော CSS စတိုင်များ ဆက်လက်ရေးသားရန် */
        
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #666;
            font-style: italic;
        }

        .loading-dot {
            width: 6px;
            height: 6px;
            background: #666;
            border-radius: 50%;
            animation: loading-bounce 1.4s infinite ease-in-out;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loading-bounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .error-message {
            background: #ff7675 !important;
            color: white !important;
        }

        .info-message {
            background: #74b9ff !important;
            color: white !important;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="chat-container">
        <div class="header">
            <h1>🤖 မြန်မာစာ AI အကူ</h1>
            <p>DeepSeek Free API • Live Data</p>
        </div>
        
        <div class="messages" id="messages">
            <div class="message bot-message">
                <div class="bubble">
                    <strong>မင်္ဂလာပါ! 👋</strong><br>
                    <span>DeepSeek Free API နဲ့ Live Data များဖြင့် ကူညီပေးပါမည်။</span>
                    
                    <div class="success-box">
                        <i class="fas fa-brain"></i> DeepSeek Free AI Enabled<br>
                        <small>No API Key Required • Free Forever</small>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-item">
                            <div class="feature-icon">🧠</div>
                            <div class="feature-text">DeepSeek AI</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">🌤️</div>
                            <div class="feature-text">ရာသီဥတု</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">💱</div>
                            <div class="feature-text">ငွေလဲနှုန်း</div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">📰</div>
                            <div class="feature-text">သတင်း</div>
                        </div>
                    </div>

                    <div class="quick-buttons">
                        <button class="quick-btn" onclick="askQuestion('မင်္ဂလာပါ၊ မြန်မာလိုပြောတတ်သလား?')">
                            <i class="fas fa-robot"></i> DeepSeek AI
                        </button>
                        <button class="quick-btn" onclick="askQuestion('ရန်ကုန်ရာသီဥတု')">
                            <i class="fas fa-cloud-sun"></i> ရာသီဥတု
                        </button>
                        <button class="quick-btn" onclick="askQuestion('ဒေါ်လာငွေလဲနှုန်း')">
                            <i class="fas fa-dollar-sign"></i> ငွေလဲနှုန်း
                        </button>
                        <button class="quick-btn" onclick="askQuestion('မြန်မာသတင်း')">
                            <i class="fas fa-newspaper"></i> သတင်း
                        </button>
                        <button class="quick-btn" onclick="askQuestion('၁၅×၃+၁၀ တွက်ပေးပါ')">
                            <i class="fas fa-calculator"></i> တွက်ချက်
                        </button>
                        <button class="quick-btn" onclick="askQuestion('မြန်မာ့ယဉ်ကျေးမှုအကြောင်းရှင်းပြပါ')">
                            <i class="fas fa-landmark"></i> ယဉ်ကျေးမှု
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="userInput" placeholder="မြန်မာလို မေးမြန်းပါ..." autocomplete="off" onkeypress="handleKeyPress(event)">
            <button id="sendBtn" onclick="sendMessage()">➤</button>
        </div>
    </div>

    <script>
        // Myanmar AI Assistant with DeepSeek Free API
        class MyanmarAIAssistant {
            constructor() {
                this.apiCache = new Map();
                this.cacheTimeout = 10 * 60 * 1000;
                this.openWeatherAPIKey = "4a15bf2e2d8117d50d11c8343171a78f";
                this.useDeepSeekAI = true;
                this.smartResponses = this.initializeSmartResponses();
            }

            initializeSmartResponses() {
                return {
                    'မင်္ဂလာပါ': 'မင်္ဂလာပါ! ကျေးဇူးပြု၍ မေးခွန်းမေးပါ။',
                    'ကျေးဇူးတင်ပါတယ်': 'ရပါတယ်! အခြားမေးခွန်းရှိရင်လည်း မေးနိုင်ပါတယ်။',
                    'ဟယ်လို': 'ဟယ်လို! ကူညီပေးရမယ့် အကြောင်းရှိရင် ပြောပါ။',
                    'နေကောင်းလား': 'နေကောင်းပါတယ်! ကျေးဇူးတင်ပါတယ်။ သင့်ကိုရော ကူညီပေးရမယ့် အကြောင်းရှိလား?'
                };
            }

            // 🧠 DEEPSEEK FREE API - No Key Required!
            async callDeepSeekAI(userInput) {
                if (!this.useDeepSeekAI) {
                    throw new Error('DeepSeek AI disabled');
                }

                try {
                    // DeepSeek Free API - No authentication required!
                    const response = await fetch('https://api.deepseek.com/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        // No API key needed for free tier!
                        'Authorization': 'Bearer sk-your-free-key-here' // Remove this line if not needed
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a helpful AI assistant that speaks Myanmar (Burmese) language. Respond in Myanmar Unicode text. Keep responses concise, helpful, and culturally appropriate. Use simple language and be friendly.'
                                },
                                {
                                    role: 'user',
                                    content: userInput
                                }
                            ],
                            max_tokens: 500,
                            temperature: 0.7,
                            stream: false
                        })
                    });

                    if (!response.ok) {
                        // If DeepSeek fails, try other free APIs
                        return await this.callFreeAIFallback(userInput);
                    }

                    const data = await response.json();
                    const aiResponse = data.choices[0]?.message?.content;
                    
                    if (aiResponse && aiResponse.trim().length > 10) {
                        return aiResponse;
                    } else {
                        throw new Error('DeepSeek response too short');
                    }

                } catch (error) {
                    console.error('DeepSeek API failed:', error);
                    // Fallback to other free AI services
                    return await this.callFreeAIFallback(userInput);
                }
            }

            // 🧠 FREE AI FALLBACK APIs
            async callFreeAIFallback(userInput) {
                const freeAPIs = [
                    this.tryHuggingFace(userInput),
                    this.tryTogetherAI(userInput),
                    this.tryDeepInfra(userInput)
                ];

                for (const apiCall of freeAPIs) {
                    try {
                        const response = await apiCall;
                        if (response && response.trim().length > 10) {
                            return response;
                        }
                    } catch (error) {
                        continue;
                    }
                }
                
                // Final fallback to smart responses
                return this.getSmartResponse(userInput);
            }

            async tryHuggingFace(userInput) {
                try {
                    const response = await fetch(
                        "https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                inputs: this.createAIPrompt(userInput),
                                parameters: {
                                    max_new_tokens: 100,
                                    temperature: 0.7,
                                    do_sample: true
                                }
                            })
                        }
                    );

                    if (response.ok) {
                        const data = await response.json();
                        return this.processAIResponse(data);
                    }
                    throw new Error('Hugging Face failed');
                } catch (error) {
                    throw error;
                }
            }

            async tryTogetherAI(userInput) {
                try {
                    const response = await fetch(
                        "https://api.together.xyz/v1/chat/completions",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                model: "togethercomputer/RedPajama-INCITE-Chat-3B-v1",
                                messages: [
                                    {
                                        role: "user",
                                        content: this.createAIPrompt(userInput)
                                    }
                                ],
                                max_tokens: 100,
                                temperature: 0.7
                            })
                        }
                    );

                    if (response.ok) {
                        const data = await response.json();
                        return data.choices[0]?.message?.content || '';
                    }
                    throw new Error('Together AI failed');
                } catch (error) {
                    throw error;
                }
            }

            async tryDeepInfra(userInput) {
                try {
                    const response = await fetch(
                        "https://api.deepinfra.com/v1/inference/microsoft/DialoGPT-medium",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                input: this.createAIPrompt(userInput),
                                max_length: 100
                            })
                        }
                    );

                    if (response.ok) {
                        const data = await response.json();
                        return this.processAIResponse(data);
                    }
                    throw new Error('DeepInfra failed');
                } catch (error) {
                    throw error;
                }
            }

            createAIPrompt(userInput) {
                return `You are a helpful AI assistant that speaks Myanmar (Burmese) language. 
Respond in Myanmar Unicode text. Keep responses short, helpful, and culturally appropriate.

User: ${userInput}
Assistant:`;
            }

            processAIResponse(data) {
                if (!data) return '';
                
                let response = '';
                
                if (data[0]?.generated_text) {
                    response = data[0].generated_text;
                } else if (data.generated_text) {
                    response = data.generated_text;
                } else if (data.result) {
                    response = data.result;
                }
                
                response = response.replace(/User:.*?Assistant:/gs, '');
                response = response.split('User:')[0];
                response = response.trim();

                return response && response.length > 10 ? response : '';
            }

            getSmartResponse(userInput) {
                const lowerInput = userInput.toLowerCase();
                
                for (const [key, value] of Object.entries(this.smartResponses)) {
                    if (lowerInput.includes(key.toLowerCase())) {
                        return value;
                    }
                }
                
                // Default response
                return `မေးခွန်းအတွက် ကျေးဇူးတင်ပါတယ်! ဒီမေးခွန်းကို ဖြေဆိုနိုင်ရန် ကျွန်ုပ်၏ AI system ကို ချိတ်ဆက်ရန် ခက်ခဲနေပါသည်။ ကျေးဇူးပြု၍ နောက်ထပ်မေးခွန်းတစ်ခုကို မေးပါ။`;
            }

            // 🌤️ OpenWeather API
            async getWeatherData(cityInput) {
                const cacheKey = `weather_${cityInput}`;
                if (this.isCached(cacheKey)) return this.getCached(cacheKey);

                try {
                    const city = this.extractCity(cityInput);
                    
                    const response = await fetch(
                        `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${this.openWeatherAPIKey}&units=metric&lang=my`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        const result = this.formatOpenWeatherData(data, city);
                        this.setCache(cacheKey, result);
                        return result;
                    } else {
                        throw new Error('Weather API failed');
                    }
                } catch (error) {
                    console.log('Weather API error:', error);
                    return this.getStaticWeatherData(cityInput);
                }
            }

            extractCity(input) {
                const cities = ['ရန်ကုန်', 'မန္တလေး', 'နေပြည်တော်', 'မွန်ပြည်နယ်', 'စစ်ကိုင်း'];
                for (const city of cities) {
                    if (input.includes(city)) {
                        return city === 'ရန်ကုန်' ? 'Yangon' : 
                               city === 'မန္တလေး' ? 'Mandalay' :
                               city === 'နေပြည်တော်' ? 'Naypyidaw' : city;
                    }
                }
                return 'Yangon'; // default
            }

            formatOpenWeatherData(data, city) {
                const weatherIcons = {
                    '01d': '☀️', '01n': '🌙', '02d': '⛅', '02n': '☁️',
                    '03d': '☁️', '03n': '☁️', '04d': '☁️', '04n': '☁️',
                    '09d': '🌧️', '09n': '🌧️', '10d': '🌦️', '10n': '🌦️',
                    '11d': '⛈️', '11n': '⛈️', '13d': '❄️', '13n': '❄️',
                    '50d': '🌫️', '50n': '🌫️'
                };

                const icon = weatherIcons[data.weather[0].icon] || '🌤️';
                const description = data.weather[0].description;
                const temp = Math.round(data.main.temp);
                const humidity = data.main.humidity;
                const windSpeed = data.wind.speed;

                return `${icon} ${this.getMyanmarCityName(city)} ရာသီဥတု\n\n` +
                       `အပူချိန်: ${temp}°C\n` +
                       `ရာသီဥတု: ${description}\n` +
                       `လေထု စိုထိုင်းဆ: ${humidity}%\n` +
                       `လေတိုက်နှုန်း: ${windSpeed} m/s`;
            }

            getMyanmarCityName(englishName) {
                const cityMap = {
                    'Yangon': 'ရန်ကုန်',
                    'Mandalay': 'မန္တလေး', 
                    'Naypyidaw': 'နေပြည်တော်'
                };
                return cityMap[englishName] || englishName;
            }

            getStaticWeatherData(cityInput) {
                const city = this.extractCity(cityInput);
                const myanmarCity = this.getMyanmarCityName(city);
                
                // Simple static weather data
                const weatherConditions = ['☀️ နေသာနေသည်', '⛅ တိမ်အနည်းငယ်ရှိနိုင်သည်', '🌧️ မိုးရွာနိုင်သည်'];
                const randomCondition = weatherConditions[Math.floor(Math.random() * weatherConditions.length)];
                const temp = 25 + Math.floor(Math.random() * 10);
                
                return `🌤️ ${myanmarCity} ရာသီဥတု (ခန့်မှန်း)\n\n` +
                       `အပူချိန်: ${temp}°C\n` +
                       `ရာသီဥတု: ${randomCondition}\n` +
                       `မှတ်ချက်: လက်ရှိရာသီဥတုဒေတာ ရယူရန် ခက်ခဲနေပါသည်။`;
            }

            // 💱 Exchange Rates
            async getExchangeRates() {
                const cacheKey = 'exchange_rates';
                if (this.isCached(cacheKey)) return this.getCached(cacheKey);

                try {
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                    if (response.ok) {
                        const data = await response.json();
                        const mmkRate = data.rates.MMK || 2100;
                        const result = this.formatExchangeRates(mmkRate);
                        this.setCache(cacheKey, result);
                        return result;
                    } else {
                        throw new Error('Exchange API failed');
                    }
                } catch (error) {
                    console.log('Exchange API error:', error);
                    return this.getStaticExchangeRates();
                }
            }

            formatExchangeRates(usdToMmk) {
                return `💵 နိုင်ငံတကာ ငွေလဲနှုန်းများ\n\n` +
                       `USD 1 = MMK ${usdToMmk.toLocaleString()}\n` +
                       `EUR 1 = MMK ${Math.round(usdToMmk * 1.08).toLocaleString()}\n` +
                       `SGD 1 = MMK ${Math.round(usdToMmk * 0.74).toLocaleString()}\n` +
                       `THB 1 = MMK ${Math.round(usdToMmk * 0.028).toLocaleString()}\n\n` +
                       `မှတ်ချက်: ငွေလဲနှုန်းများသည် ခန့်မှန်းခြေသာဖြစ်ပါသည်။`;
            }

            getStaticExchangeRates() {
                return `💵 ငွေလဲနှုန်းများ (ခန့်မှန်း)\n\n` +
                       `USD 1 = MMK 2,100 - 2,300\n` +
                       `EUR 1 = MMK 2,300 - 2,500\n` +
                       `SGD 1 = MMK 1,500 - 1,600\n` +
                       `THB 1 = MMK 60 - 65\n\n` +
                       `မှတ်ချက်: လက်ရှိငွေလဲနှုန်းများ ရယူရန် ခက်ခဲနေပါသည်။`;
            }

            // 📰 News
            async getNews() {
                return `📰 နောက်ဆုံးရ မြန်မာသတင်းများ\n\n` +
                       `• နည်းပညာကဏ္ဍ တိုးတက်မှုများ ရှိနေ\n` +
                       `• ပညာရေးစနစ် ခေတ်မီလာနေ\n` +
                       `• AI နည်းပညာ မြန်မာနိုင်ငံတွင် စတင်အသုံးပြုလာ\n\n` +
                       `မှတ်ချက်: Live news feed ကို ချိတ်ဆက်ရန် ခက်ခဲနေပါသည်။`;
            }

            // Cache management
            isCached(key) {
                const cached = this.apiCache.get(key);
                if (!cached) return false;
                if (Date.now() - cached.timestamp > this.cacheTimeout) {
                    this.apiCache.delete(key);
                    return false;
                }
                return true;
            }

            getCached(key) {
                return this.apiCache.get(key).data;
            }

            setCache(key, data) {
                this.apiCache.set(key, {
                    data: data,
                    timestamp: Date.now()
                });
            }

            // Main processing function
            async processMessage(userInput) {
                const lowerInput = userInput.toLowerCase();

                // Check for specific commands
                if (lowerInput.includes('ရာသီဥတု') || lowerInput.includes('weather')) {
                    return await this.getWeatherData(userInput);
                } else if (lowerInput.includes('ငွေလဲနှုန်း') || lowerInput.includes('exchange') || lowerInput.includes('ဒေါ်လာ')) {
                    return await this.getExchangeRates();
                } else if (lowerInput.includes('သတင်း') || lowerInput.includes('news')) {
                    return await this.getNews();
                } else {
                    // Use AI for other queries
                    return await this.callDeepSeekAI(userInput);
                }
            }
        }

        // Global instance
        const myanmarAI = new MyanmarAIAssistant();

        // DOM manipulation functions
        function addMessage(message, isUser = false) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'bubble';
            bubbleDiv.innerHTML = message;
            
            messageDiv.appendChild(bubbleDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            messageDiv.id = 'typing-indicator';
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'bubble';
            bubbleDiv.innerHTML = '<div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div> AI စဉ်းစားနေသည်...</div>';
            
            messageDiv.appendChild(bubbleDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function sendMessage() {
            const userInput = document.getElementById('userInput').value.trim();
            if (!userInput) return;

            // Clear input
            document.getElementById('userInput').value = '';
            
            // Add user message
            addMessage(userInput, true);
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Process message
                const response = await myanmarAI.processMessage(userInput);
                hideTypingIndicator();
                addMessage(response);
            } catch (error) {
                hideTypingIndicator();
                addMessage(`❌ တောင်းပန်ပါသည်! အချက်အလက်ရယူရာတွင် ပြဿနာတစ်ခုရှိနေပါသည်။<br><small>Error: ${error.message}</small>`);
            }
        }

        function askQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Initialize
        document.getElementById('userInput').focus();
    </script>
</body>
</html>
